{% extends "base.html" %}

{% block title %}Questions - MCQ Generator{% endblock %}

{% block content %}
<div class="card">
    <h2>ðŸ“š Question Bank</h2>
    <p>Total Questions: {{ questions|length }}</p>
    
    <div class="form-group">
        <label>Filter by Subject</label>
        <select id="subjectFilter" onchange="filterQuestions()">
            <option value="all">All Subjects</option>
            {% for subject in subjects %}
            <option value="{{ subject }}">{{ subject }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<div id="questionsList">
    {% for q in questions %}
    <div class="question-item" data-subject="{{ q.subject }}">
        <h4>Q{{ loop.index }}: {{ q.question }}</h4>
        <div class="options">
            {% for option in q.options %}
            <div class="option {% if loop.index0 == q.correct_answer %}correct{% endif %}">
                {{ ['A', 'B', 'C', 'D'][loop.index0] }}. {{ option }}
                {% if loop.index0 == q.correct_answer %}âœ“{% endif %}
            </div>
            {% endfor %}
        </div>
        <p style="margin-top: 10px; color: #666;">
            <strong>Subject:</strong> {{ q.subject }} | 
            <strong>Chapter:</strong> {{ q.chapter }} | 
            <strong>Difficulty:</strong> {{ q.difficulty }}
        </p>
        <div class="question-actions">
            <button onclick="deleteQuestion({{ q.id }})" class="btn btn-danger">Delete</button>
        </div>
    </div>
    {% else %}
    <div class="card">
        <p>No questions found. Upload a PDF or add questions manually.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function filterQuestions() {
    const filter = document.getElementById('subjectFilter').value;
    const items = document.querySelectorAll('.question-item');
    
    items.forEach(item => {
        if (filter === 'all' || item.dataset.subject === filter) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}

async function deleteQuestion(questionId) {
    if (!confirm('Are you sure you want to delete this question?')) {
        return;
    }
    
    try {
        const response = await fetch(`/delete_question/${questionId}`, {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAlert(data.message, 'success');
            location.reload();
        } else {
            showAlert(data.error || 'Delete failed', 'error');
        }
    } catch (error) {
        showAlert('Error: ' + error.message, 'error');
    }
}
</script>
{% endblock %}
